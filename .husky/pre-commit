#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo 'ğŸ—ï¸ğŸ‘· Testing, styling and building your project before committing'

# Run tests
npm test || (
        echo 'ğŸš¨ ğŸ— Tests failed

        Your code has failed tests.
        Make the necessary changes and try again.

        ğŸ’¡ Run "npm test" to see the errors
        '
        false;
)

echo 'âœ… ğŸ— All tests properly passed'

# Format and lint code automatically
npx lint-staged

# Check Prettier standards in case lint-staged fail
npm run format:check || (
        echo 'ğŸš¨ âœ¨ Prettier standards check failed
        
        It wasnâ€™t possible to format your code automatically.
        Make the required changes listed above, add changes and try to commit again.

        ğŸ’¡ You can also run `npm run format:check` to see the issues and fix them manually.
        '
        false;
)

echo 'âœ… âœ¨ Code is properly formatted'

# Check ESLint Standards in case lint-staged fail
npm run lint:check || (
        echo 'ğŸš¨ âœğŸ» ESLint standards check failed

        It wasnâ€™t possible to fix your lint issues automatically.
        Make the required changes listed above, add changes and try to commit again.

        ğŸ’¡ You can also run `npm run lint:check` to see the issues and fix them manually.
        '
        false; 
)

echo 'âœ… âœğŸ» Code is properly linted'

# Check tsconfig standards
npm run types:check || (
        echo 'ğŸš¨ ğŸ“¦ TypeScript standards check failed
        
        TypeScript transpiler found some issues.
        Make the changes required above.
        
        ğŸ’¡ You can also run `npm run types:check` to see the issues and fix them manually.
        '
        false;
)

echo 'âœ… ğŸ“¦ Code is properly typed'

# Build project
npm run build || (
        echo 'ğŸš¨ ğŸ‘·ğŸ» Build try failed
        
        Build process failed, please check the above errors.

        ğŸ’¡ You can also run `npm run build` to see the issues and fix them manually.
        '
        false;
)

echo 'âœ… ğŸ‘·ğŸ» Project built successfully'
echo 'âœ… All validation checks passed. Commiting... ğŸ¤˜ğŸ»'
